# Sprint Plan — 2025-11-26 (Модальные окна и оплата)

## 1. Цели спринта

- Сфокусироваться на поведении и функционале модальных окон.
- Завершить основной функционал модального окна оплаты.
- Настроить расписание и расчёт времени, от которого зависят модалки.
- Обновлять календарь и визуальные статусы броней в соответствии с логикой модалок.

Общий целевой объём спринта: ≈90 h.

---

## 2. Задачи спринта

### 2.1. Базовое поведение модальных окон

- [High · 6 h · In Progress] Модальное окно подтверждения отмены действий с бронью
- [High · 3 h · Not Started · зависит от «Модальное окно подтверждения отмены действий с бронью»] Модальное окно оплаты: закрытие через модальное окно подтверждения отмены (аналогично поведению добавления клиента)
- [Medium · 2 h · Not Started] Унифицированное поведение закрытия модальных окон (кроме окна подтверждения отмены): клик по фону, кнопка «Отмена», Esc и крестик должны одинаково закрывать модалку

**Итого по разделу 2.1:** 11 h

---

### 2.2. Модальное окно оплаты: бизнес-логика

- [High · 2 h · Not Started] В модальном окне оплаты при добавлении нового способа оплаты исключать из списка уже выбранные по этой брони способы оплаты
- [Medium · 2 h · Not Started] В модальном окне оплаты отображать блок «Итого» — сумму всех внесённых по брони платежей (если больше одного способа оплаты)
- [Medium · 2 h · Not Started] В модальном окне оплаты добавить показатель «К оплате» (остаток к оплате: стоимость брони минус внесённые платежи)
- [High · 1,5 h · Not Started] Если бронь полностью оплачена, кнопка «Внести оплату» заменяется неактивной кнопкой «Оплачено» по стилю кнопки «Добавить клиента» на главной
- [High · 2 h · Not Started] В поле ввода суммы оплаты добавить валидации: корректный числовой формат, неотрицательное значение и верхнее ограничение — не больше остатка к оплате по текущей брони

**Итого по разделу 2.2:** 9,5 h

Суммарно разделы 2.1–2.2: 20,5 h

---

### 2.3. Время и расписание для модалок

- [High · 10 h · Not Started] Подготовить API/сервис для работы с диапазонами дат и часов работы объектов
- [High · 6 h · Not Started · зависит от «Подготовить API/сервис для работы с диапазонами дат и часов работы объектов»] В модалках создания и редактирования брони при изменении даты пересчитывать доступное время начала, длительность и окончание с учётом расписания сценария/объекта
- [High · 3 h · Not Started] Дефолтное время в календаре = время работы сценария (кратно часу)

**Итого по разделу 2.3:** 19 h

Суммарно разделы 2.1–2.3: 39,5 h

---

### 2.4. Специалисты, направления и услуги в модалках

- [High · 14 h · Not Started] Добавить атрибут «направление» (множественный) + синхронизировать выбор в модалках создания/редактирования
- [High · 3 h · Not Started] Поведение услуг: поиск + ранжировка по частоте (категории — позже)

**Итого по разделу 2.4:** 17 h

Суммарно разделы 2.1–2.4: 56,5 h

---

### 2.5. Календарь и визуальные статусы, связанные с модалками

- [High · 12 h · Not Started] Обновление сетки календаря по триггеру успешного создания/редактирования/удаления брони в том же интерфейсе: AJAX‑обновление блока без перезагрузки страницы, с возможностью запуска при записи брони в БД из внешнего API сайта
- [Medium · 2 h · Not Started] Визуальное выделение забронированных ячеек в сетке календаря (фон блока брони)
- [Medium · 0,5 h · Not Started · зависит от «Визуальное выделение забронированных ячеек в сетке календаря (фон блока брони)»] Полупрозрачное отображение броней в статусах до подтверждения в сетке календаря (50% прозрачность фона блока брони)
- [Medium · 0,5 h · Not Started] Индикатор комментария: точка в правом верхнем углу блока брони, если у брони есть непустой комментарий

**Итого по разделу 2.5:** 15 h

---

### 2.6. Интеграция с API сайта и коммуникация

- [High · 12 h · Not Started] Привести текущую версию CRM к полной совместимости с API сайта, проверить создание, обновление и удаление ключевых сущностей (брони, специалисты, направления и др.) через API
- [Medium · 8 h · Not Started] Коммуникация и согласование по API‑интеграции: промежуточные синхронизации по завершённым блокам, согласование макетов и интеграции, корректировка задач по итогам обратной связи

**Итого по разделу 2.6:** 20 h

Суммарно разделы 2.1–2.6: 91,5 h

---

## 3. Итог спринта

- Плановый объём спринта: **≈91,5 h**.
- Фокус: модальные окна (поведение + оплата), расчёт времени и расписание, визуальные статусы и обновление календаря, интеграция с API сайта, а также ключевая бизнес-логика (направления и услуги), влияющая на модалки.
