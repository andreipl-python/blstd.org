# Sprint Plan — 2025-11-26 (Модальные окна и оплата)

  ## 1. Цели спринта

  - Сфокусироваться на поведении и функционале модальных окон.
  - Завершить основной функционал модального окна оплаты.
  - Настроить расписание и расчёт времени, от которого зависят модалки.
  - Обновлять календарь и визуальные статусы броней в соответствии с логикой модалок.

  Общий целевой объём спринта: ≈90 h.

---

## 2. Задачи спринта

  ### 2.1. Базовое поведение модальных окон

  - [High · 6 h · Done] Модальное окно подтверждения отмены действий с бронью
  - [High · 3 h · Done · зависит от «Модальное окно подтверждения отмены действий с бронью»] Модальное окно оплаты: закрытие через модальное окно подтверждения отмены (аналогично поведению добавления клиента)
  - [Medium · 2 h · Done] Унифицированное поведение закрытия модальных окон (кроме окна подтверждения отмены): клик по фону, кнопка «Отмена», Esc и крестик должны одинаково закрывать модалку
  - [Medium · 1 h · Done] Публичный ID в правом верхнем углу модалки (на уровне заголовка)
  - [Medium · 0,25 h · Done] Фикс блокировки прокрутки после выхода из цепочки модалок (инфо → редактирование → назад)

  **Итого по разделу 2.1:** 12,25 h

---

  ### 2.2. Модальное окно оплаты: бизнес-логика

  - [High · 4 h · Done] В модальном окне оплаты: фронтовый шаблон и поведение блока «способ оплаты + сумма» при добавлении и удалении (кнопка «Добавить способ оплаты», дублирование и удаление блоков)
  - [High · 4 h · Done · зависит от «В модальном окне оплаты: фронтовый шаблон и поведение блока “способ оплаты + сумма” при добавлении и удалении»] В модальном окне оплаты: логика перерасчёта выпадающих списков способов оплаты (ограничение количества блоков числом доступных типов, исключение уже выбранных типов и скрытие блока «Добавить способ оплаты» при исчерпании вариантов)
  - [Medium · 1,5 h · Done] В модальном окне оплаты: фронтовый шаблон блока «Итого» (структура и базовая вёрстка)
  - [Medium · 2 h · Done · зависит от «В модальном окне оплаты: фронтовый шаблон блока “Итого” (структура и базовая вёрстка)”] В модальном окне оплаты: функционал расчёта блока «Итого» (сумма всех внесённых по брони платежей при нескольких способах оплаты)
  - [Medium · 1 h · Done] В модальном окне оплаты добавить показатель «К оплате» — статический фронтовый блок (без логики расчёта)
  - [Medium · 1 h · Done] В модальном окне оплаты: заполнение выпадающего списка «Способ оплаты» из базы данных (PaymentType)
  - [Medium · 1,5 h · Done] Реализовать функционал показателя «К оплате» — расчёт остатка к оплате (стоимость брони минус внесённых платежей)
  - [High · 1,5 h · Done] Если бронь полностью оплачена, кнопка «Внести оплату» заменяется неактивной кнопкой «Оплачено» по стилю кнопки «Добавить клиента» на главной
  - [High · 2 h · Done] В поле ввода суммы оплаты добавить валидацию ввода: корректный числовой формат, неотрицательное значение и верхний предел 99 999,99 BYN
 

  **Итого по разделу 2.2:** 18,5 h

  Суммарно разделы 2.1–2.2: 30,75 h

---

  ### 2.3. Время и расписание для модалок

  - [High · 10 h · Not Started] Подготовить API/сервис для работы с диапазонами дат и часов работы объектов
  

  **Итого по разделу 2.3:** 10 h

  Суммарно разделы 2.1–2.3: 40,75 h

---

  ### 2.4. Специалисты, направления и услуги в модалках

  - [High · 14 h · Not Started] Добавить атрибут «направление» (множественный) + синхронизировать выбор в модалках создания/редактирования

  **Итого по разделу 2.4:** 14 h

  Суммарно разделы 2.1–2.4: 54,75 h

---

### 2.5. Календарь и визуальные статусы, связанные с модалками

- [High · 12 h · Done] Обновление сетки календаря по триггеру успешного создания/редактирования/удаления брони в том же интерфейсе: AJAX‑обновление блока без перезагрузки страницы, с возможностью запуска при записи брони в БД из внешнего API сайта
- [Medium · 2 h · Done] Визуальное выделение забронированных ячеек в сетке календаря (фон блока брони)
 

**Итого по разделу 2.5:** 14 h

---

  ### 2.6. Интеграция с API сайта и коммуникация

  - [High · 12 h · Done] Привести текущую версию CRM к полной совместимости с API сайта, проверить создание, обновление и удаление ключевых сущностей (брони, специалисты, направления и др.) через API
  - [Medium · 8 h · Done] Коммуникация и согласование по API‑интеграции: промежуточные синхронизации по завершённым блокам, согласование макетов и интеграции, корректировка задач по итогам обратной связи

  **Итого по разделу 2.6:** 20 h

  Суммарно разделы 2.1–2.6: 88,75 h

---

  ## 3. Итог спринта

-  - Плановый объём спринта: **≈88,75 h**.
  - Фокус: модальные окна (поведение + оплата), расчёт времени и расписание, визуальные статусы и обновление календаря, интеграция с API сайта, а также ключевая бизнес-логика (направления и услуги), влияющая на модалки.
