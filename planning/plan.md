# CRM Project Plan

## 1. UI/UX: Основные экраны и взаимодействия

- **Главная страница**
  - [High · Ожидание дизайнера] Дизайн календаря (ждём от дизайнера)
  - [Medium · 2 h] Правый нижний угол: попап с кнопкой «вверх»
  - [High · 4 h] Счётчик заявок в шапке главной страницы: отображать количество броней в статусе «требует подтверждения» и обновлять его при создании и изменении таких броней

- **Фильтры и списки**
  - [High · 1 h] Поведение списка клиентов: 10 строк, скролл, ранжировка по алфавиту

- **Календарь и таблица**
  - [High · 6 h · ожидание решения заказчика] Пошаговая загрузка календаря по дням вместо оверлея (моментальная отрисовка дня и его броней, затем следующих дней)
  - [Medium · 0,5 h] Pop-up на пустую ячейку: скруглённые углы без границы, как у попапа занятой ячейки

- **Окно авторизации**
  - [High · 1 h] Шаблон окна авторизации (базовая вёрстка)
  - [Medium · 1 h] Перенос дизайна окна авторизации из Figma

- **Попап информации о пользователе**
  - [High · 1 h] Шаблон попапа информации о пользователе с кнопкой «Выйти»
  - [Medium · 1 h] Перенос дизайна попапа информации о пользователе из Figma

- **Модальные окна**
  - **Добавление абонемента**
    - [High · 2 h] Шаблон модального окна добавления абонемента
    - [Medium · 1 h] Перенос дизайна модального окна добавления абонемента из Figma
    - [High · 2 h] Сценарно‑зависимый шаблон модалки добавления абонемента (Музыкальная школа / Репетиционная точка / Музыкальный класс)
    - [Medium · 2 h] В модалке добавления абонемента для «Репетиционная точка» и «Музыкальный класс»: селект «Клиент/Группа» вместо «Клиент»
  - **Абонементы клиента (информация)**
    - [High · 2 h] Шаблон модального окна «Абонементы клиента» (список абонементов, пометка «групповой»)

## 2. Функциональность и бизнес-логика

- **Бронирования и расписание**
  - [Medium · 2 h] Багфикс: восстановить предупреждение времени начала при сбросе длительности (создание/редактирование)

- **Оплаты и биллинг**
  - [Medium · 3 h] В модальном окне оплаты: перенос финального дизайна блока «Итого» из Figma
  - [Medium · 1 h · после макета дизайна] Модальное окно истории оплат: перенос финального дизайна модалки из Figma
  - [High · 8 h] Функционал абонементов и тарифных единиц (модели, расчёт остатка, учёт списаний)
  - [High · 3 h] Оплата тарифными единицами в модальном окне оплаты (списание, проверка балансов)
  - [Medium · 2 h] Функционал модального окна обратной связи после внесения оплаты

- **Клиенты и абонементы**
  - [High · 4 h] Функционал модального окна добавления абонемента (привязка к клиенту, сценарию и срокам)
  - [Medium · 3 h] Модалка добавления абонемента (Репетиционная точка/Музыкальный класс): функционал выбора «Клиент/Группа» (загрузка списка, сохранение, валидации)
  - [Medium · 2 h] Функционал модального окна обратной связи после добавления клиента
  - [High · 10 h] Модель абонемента «Музыкальная школа»: направления (not null, любое количество), услуга специалиста, номинал (кол-во услуг), стоимость, активность, срок действия, название
  - [High · 10 h] Модель абонемента «Репетиционная точка/Музыкальный класс»: тариф, номинал (кол-во тарифов), стоимость, активность, срок действия, название
  - [High · 6 h] Модалка добавления абонемента: сценарная логика (какие поля/модели используются в зависимости от выбранного сценария на главной)
  - [High · 6 h] Информация об абонементах клиента: API/эндпоинт + модалка «Абонементы клиента» (сценарно‑зависимый список)
  - [High · 4 h] Модалки создания/редактирования брони: поле «Абонемент» кликабельно (как история оплат) и открывает «Абонементы клиента»

- **Авторизация и сессии**
  - [High · 3 h] Функционал авторизации по шаблону окна (валидация, создание сессии)
  - [Medium · 2 h] Функционал выхода из системы (кнопка «Выйти» в попапе пользователя, очистка сессии, редирект на окно авторизации)

- **Фавикон**
  - [Low · Ожидание от Кирилла] Фавикон (файл пришлёт Кирилл)

- **Деплой и миграция**
  - [High · 4 h] Анализ структуры базы данных старого приложения и разработка стратегии переноса совместно с заказчиком
  - [High · 8 h] Написание скриптов для автоматизации переноса данных из старой БД в новую (с согласованием моделей данных)
  - [High · 6 h] Деплой MVP версии приложения на сервер заказчика (настройка системы, установка служб, настройка бэкапов)
  - [High · 4 h] Перенос данных из старой БД в новую БД и первичная проверка корректности

## 3. Аналитика и отчётность

- [Medium · Ожидание данных] Черновик структуры аналитики (получить от Кирилла)

## 4. Зависимости и порядок

1. **Фильтры, списки и базовый календарь**  
   Задачи раздела 1 → «Фильтры и списки» выполняются до усложнения бизнес‑логики бронирований, чтобы выбор сценария/помещений/специалистов был стабильным. Базовый календарь считается реализованным и служит основой для дальнейших ограничений доступности.

2. **Модальные окна (UI)** (раздел 1 → «Модальные окна»)  
   - Сначала шаблоны и визуальные состояния (ошибки/предупреждения, disabled‑поля, плейсхолдеры), затем функциональность, которая опирается на эти состояния.  
   - Сценарно‑зависимые шаблоны (абонементы, логика полей брони под разные сценарии) делаются до сценарной логики открытия/подстановки.

3. **Бронирования и расписание — быстрые UX/валидации** (раздел 2 → «Бронирования и расписание»)  
   - Обязательность длительности, восстановление предупреждений при сбросах и единый красный стиль ошибок делаются раньше крупных изменений по моделям, чтобы уменьшить количество ошибок ввода уже сейчас.

4. **Специалисты и доступность** (раздел 2 → «Бронирования и расписание»)  
   - Модель расписания специалиста (интервалы в рамках дня, включая «кусочки») делается до любых доработок, которые требуют точного расчёта доступности преподавателей.  
   - Пересчёт доступности и правило «специалист бронирует под себя как клиент — он недоступен» идут до интеграции услуг специалистов и тарифов.

5. **Услуги специалистов и длительность брони**  
   - Сначала модель услуг специалистов и связь со специалистами, затем подключение этих услуг в модалки брони.  
   - Зависимость длительности брони от выбранной услуги (Музыкальная школа) реализуется после появления самой модели услуги и её длительности.

6. **Тарифы и ограничения календаря**  
   - Сначала модель тарифов и поле «количество людей» в бронированиях, затем фильтрация тарифов в модалках и валидации.  
   - Отрисовка «дыр» (недоступных ячеек) в календаре зависит от корректной модели тарифов и логики определения доступных интервалов.

7. **Клиенты и абонементы** (раздел 2 → «Клиенты и абонементы»)  
   - Сначала модели абонементов (Музыкальная школа / Репетиционная точка / Музыкальный класс) и правила привязки (направления/услуги/тарифы), затем сценарная логика модалки добавления абонемента.  
   - Выбор «Клиент/Группа» в модалке добавления абонемента (и пометка «групповой») делается до модалки «Абонементы клиента» и до кликабельности поля «Абонемент» в брони.
   - Модалка «Абонементы клиента» и кликабельность поля «Абонемент» в брони идут после того, как есть модели и API для получения списка абонементов клиента/группы.

8. **Оплаты и биллинг** (раздел 2 → «Оплаты и биллинг»)  
   - Задачи по оплате тарифными единицами и учёту списаний зависят от стабилизированных моделей абонементов/тарифов и их номиналов.

9. **Календарь и таблица** (раздел 1 → «Календарь и таблица»)  
   - Визуальные улучшения календаря (зебра, попапы, пресеты) можно делать параллельно, но ограничения доступности (рабочие часы, тарифные «дыры») выполняются после стабилизации логики доступности из раздела 2.

10. **Авторизация, деплой/миграция, аналитика и фавикон**  
   Эти блоки выполняются после стабилизации ключевых пользовательских сценариев и получения внешних материалов.
