# CRM Project Plan

## 1. UI/UX: Основные экраны и взаимодействия

- **Главная страница**
  - [High · Ожидание дизайнера] Дизайн календаря (ждём от дизайнера)
  - [Medium · 2 h] Правый нижний угол: попап с кнопкой «вверх»
  - [High · 4 h] Счётчик заявок в шапке главной страницы: отображать количество броней в статусе «требует подтверждения» и обновлять его при создании и изменении таких броней

- **Фильтры и списки**
  - [Medium · 1 h] Дефолт блока специалистов: всё свёрнуто
  - [High · 2 h] Блок специалистов: интерактивное сворачивание/разворачивание
  - [High · 1 h] Поведение списка клиентов: 10 строк, скролл, ранжировка по алфавиту

- **Календарь и таблица**
  - [Medium · 0,5 h] Полупрозрачное отображение броней в статусах до подтверждения в сетке календаря (50% прозрачность фона блока брони)
  - [Medium · 3 h] Всплывающее окно для забронированной ячейки в сетке календаря с краткой информацией о брони
  - [Medium · 0,5 h] Индикатор комментария: точка в правом верхнем углу блока брони, если у брони есть непустой комментарий
  - [Medium · 1 h] Сетка календаря: фон блока брони «зеброй» (полосками) для броней, которые ещё не полностью оплачены
  - [High · 6 h] Пошаговая загрузка календаря по дням вместо оверлея (моментальная отрисовка дня и его броней, затем следующих дней)
  - [Medium · 0,5 h] Пресет «Текущие 14 дней (сегодня + 13 дней)» в попапе выбора диапазона дат
  - [Medium · 1 h] Обновление набора пресетов календаря: «Сегодня, Вчера, Завтра, Эта неделя, Прошлая неделя, Следующая неделя, Этот месяц, Прошлый месяц»
  - [High · 6 h] Сетка календаря по режиму работы помещения (ограничение отображаемого времени рабочими часами помещения, деактивация ячеек вне рабочего времени сценария)
  - [Medium · 0,5 h] Pop-up на пустую ячейку: скруглённые углы без границы, как у попапа занятой ячейки
  - [High · 6 h] Отрисовка всех броней всех сценариев на календаре с серым отображением и блокировкой создания/редактирования в ячейках, занятых другими сценариями

- **Окно авторизации**
  - [High · 1 h] Шаблон окна авторизации (базовая вёрстка)
  - [Medium · 1 h] Перенос дизайна окна авторизации из Figma

- **Попап информации о пользователе**
  - [High · 1 h] Шаблон попапа информации о пользователе с кнопкой «Выйти»
  - [Medium · 1 h] Перенос дизайна попапа информации о пользователе из Figma

- **Модальные окна**
  - **Добавление абонемента**
    - [High · 2 h] Шаблон модального окна добавления абонемента
    - [Medium · 1 h] Перенос дизайна модального окна добавления абонемента из Figma
  - **Удаление брони**
    - [High · 2 h] Дизайн модального окна удаления брони
    - [High · 2 h] Шаблон модального окна удаления брони
    - [Medium · 1 h] Шаблон модального окна обратной связи после удаления брони
    - [Medium · 1 h] Перенос дизайна модального окна обратной связи после удаления брони из Figma
  - **Оплаты**
    - [Medium · 1 h] Шаблон модального окна обратной связи после внесения оплаты
    - [Medium · 1 h] Перенос дизайна модального окна обратной связи после внесения оплаты из Figma

## 2. Функциональность и бизнес-логика

- **Услуги и поиск**
  - [High · 3 h] Поведение услуг: поиск + ранжировка по частоте (категории — позже)

- **Бронирования и расписание**
  - [High · 3 h] Функционал модального окна удаления брони (удаление, валидации, обновление календаря)
  - [Medium · 2 h] Функционал модального окна обратной связи после удаления брони

- **Оплаты и биллинг**
  - [Medium · 1 h · после макета дизайна] В модальном окне оплаты: перенос финального дизайна блока «Итого» из Figma
  - [Medium · 1 h · после макета дизайна] Модальное окно истории оплат: перенос финального дизайна модалки из Figma
  - [High · 3 h] Модальное окно оплаты: интерактивный пересчёт показателя «Остаток» при изменении сумм в полях ввода (мгновенное обновление блока «Стоимость / Внесено / Остаток» без перезагрузки модального окна)
  - [High · 8 h] Функционал абонементов и тарифных единиц (модели, расчёт остатка, учёт списаний)
  - [High · 3 h] Оплата тарифными единицами в модальном окне оплаты (списание, проверка балансов)
  - [Medium · 2 h] Функционал модального окна обратной связи после внесения оплаты

- **Клиенты и абонементы**
  - [High · 4 h] Функционал модального окна добавления абонемента (привязка к клиенту, сценарию и срокам)
  - [Medium · 2 h] Функционал модального окна обратной связи после добавления клиента

- **Авторизация и сессии**
  - [High · 3 h] Функционал авторизации по шаблону окна (валидация, создание сессии)
  - [Medium · 2 h] Функционал выхода из системы (кнопка «Выйти» в попапе пользователя, очистка сессии, редирект на окно авторизации)

- **Фавикон**
  - [Low · Ожидание от Кирилла] Фавикон (файл пришлёт Кирилл)

- **Деплой и миграция**
  - [High · 4 h] Анализ структуры базы данных старого приложения и разработка стратегии переноса совместно с заказчиком
  - [High · 8 h] Написание скриптов для автоматизации переноса данных из старой БД в новую (с согласованием моделей данных)
  - [High · 6 h] Деплой MVP версии приложения на сервер заказчика (настройка системы, установка служб, настройка бэкапов)
  - [High · 4 h] Перенос данных из старой БД в новую БД и первичная проверка корректности

## 3. Аналитика и отчётность

- [Medium · Ожидание данных] Черновик структуры аналитики (получить от Кирилла)

## 4. Зависимости и порядок

1. **Фильтры, списки и базовый календарь**  
   Задачи раздела 1 → «Фильтры и списки» выполняются до работ по календарю и таблице, чтобы поведение списков (клиенты, услуги, специалисты) было стабильным и предсказуемым. Базовый календарь (двухмесячный выбор периода, существующие пресеты, интеграция с фильтрами и таблицей броней) считается уже реализованным и служит основой для дальнейших доработок.

2. **Календарь и таблица** (раздел 1 → «Календарь и таблица»)  
   - Полупрозрачность броней, всплывающее окно, индикатор комментария и «зебра» для неоплаченных броней делаются поверх существующей интеграции календаря с фильтрами и таблицей броней.  
   - Новые пресеты («Текущие 14 дней», обновлённый набор сегодня/вчера/завтра/недели/месяцы) выполняются после стабилизации базового выбора периода и существующих пресетов.  
   - Пошаговая загрузка календаря по дням и сетка по режиму работы помещения выполняются после того, как текущая AJAX‑логика обновления календаря и расписания по сценариям работает надёжно.  
   - Отрисовка всех броней всех сценариев с серым отображением и блокировкой действий в занятых ячейках зависит от корректной работы логики сценариев и статусов броней в разделе 2 → «Бронирования и расписание».

3. **Модальные окна (UI)** (раздел 1 → «Модальные окна»)  
   - Шаблоны и перенос дизайна из Figma (добавление клиента, абонемента, брони, окна информации/редактирования/удаления, окна обратной связи, окна авторизации, попап пользователя и т.п.) выполняются до задач на функциональность, использующую эти модалки.  
   - Сценарно‑зависимые шаблоны для брони («Репетиционная точка», «Музыкальный класс») должны быть готовы до реализации подстановки нужных модалок при открытии.

4. **Бронирования и расписание** (раздел 2 → «Бронирования и расписание»)  
   - Пересчёт доступного времени в модалках создания/редактирования выполняется после стабилизации сервиса/логики расписаний и базовой интеграции календаря с фильтрами.  
   - Функционал модального окна удаления брони (удаление, валидации, обновление календаря) опирается на существующую модель бронирований и должен использовать уже готовый шаблон/дизайн модалки.  
   - Функционал подстановки нужных модальных окон (создания, информации, редактирования, удаления, обратной связи) по сценарию брони выполняется после реализации всех соответствующих шаблонов в разделе 1 → «Модальные окна».  
   - Модалки обратной связи по операциям с бронями (создание, удаление) выполняются после базовых операций с бронями.

5. **Клиенты и абонементы** (раздел 2 → «Клиенты и абонементы»)  
   - Функционал добавления клиента опирается на шаблон модального окна и его дизайн; отмена добавления через модалку подтверждения возможна только после появления самой логики добавления клиента.  
   - Модальное окно добавления абонемента и его функционал выполняются после базовой модели клиента и сценариев бронирований.  
   - Логика абонементов и тарифных единиц (модели, расчёт балансов, учёт списаний) должна быть реализована до задач по оплате тарифными единицами и обратной связи после оплаты.

6. **Оплаты и биллинг** (раздел 2 → «Оплаты и биллинг»)  
   - Визуальные задачи (блок «Итого» в модальном окне оплаты, история оплат по макетам из Figma) выполняются до усложнения бизнес‑логики оплат.  
   - Функционал абонементов и тарифных единиц является основой для оплаты тарифными единицами; эти задачи идут раньше, чем интеграция оплат тарифными единицами в модалке.  
   - Модальное окно обратной связи после внесения оплаты выполняется после базовой логики внесения и учёта платежей.

7. **Авторизация и сессии** (раздел 1 → «Окно авторизации», раздел 1 → «Попап информации о пользователе», раздел 2 → «Авторизация и сессии»)  
   - Шаблон и дизайн окна авторизации — основа для функционала авторизации; сначала вёрстка, затем серверная логика входа.  
   - Попап информации о пользователе и его дизайн должны быть готовы до реализации функционала выхода.  
   - Функционал выхода из системы зависит от общей реализации авторизации и механизма сессий.

8. **Деплой и миграция** (раздел 2 → «Деплой и миграция»)  
   - Анализ структуры старой БД и разработка стратегии переноса выполняются до написания скриптов миграции.  
   - Скрипты автоматизации переноса пишутся и отлаживаются до фактического переноса данных.  
   - Деплой MVP на сервер заказчика выполняется после стабилизации ключевых пользовательских сценариев (авторизация, календарь, модалки, базовые оплаты), но до окончательного переноса боевых данных, чтобы была готова инфраструктура.  
   - Перенос данных из старой БД в новую БД выполняется уже на подготовленной инфраструктуре и после согласования модели данных с заказчиком.

9. **Аналитика и фавикон** (раздел 3 → «Аналитика и отчётность», раздел 2 → «Фавикон»)  
   Эти задачи выполняются после основных пользовательских сценариев и получения внешних материалов (данные по аналитике, файл иконки).
