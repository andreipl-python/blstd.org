# Sprint Plan — sprint_jan_2026_2 (16.01.2026–31.01.2026, множественная бронь: end‑to‑end + сценарные подсветки календаря)

## 1. Цели спринта

- Завершить контур множественной брони: форма из нескольких блоков, сборка данных, серверное создание и обработка ошибок.
- Довести множественную бронь до сценарных требований: общая сумма по всем броням и подсветка календаря по правилам сценариев.
- Обеспечить качество: серверные проверки конфликтов и регрессия (одиночное создание не сломано).
- Добавить контур доступности: неактивные ресурсы/сценарии видны в сетке, но создание/редактирование броней в них заблокировано (FE + backend-защита).

Общий целевой объём спринта: ≈90 h.

---

## 2. Задачи спринта

### 2.1. Создание бронирований (массовое): форма и UI

- [High · 6 h · Planned] Поля и логика внутри блока массовой брони в зависимости от сценария (3 сценария): разные наборы полей, селекты, инициализация и переинициализация
- [High · 3 h · Planned] Обработка ответа создания нескольких бронирований: привязка ошибок к конкретному блоку и полю, подсветка, прокрутка к первой ошибке, блокировка отправки
- [Medium · 2 h · Planned] Интеграция после успешного создания массовой брони: обновление календаря и счетчиков, закрытие модального окна, уведомление об успехе

**Итого по разделу 2.1:** 11 h

---

### 2.2. Массовая бронь: сумма и календарные подсветки по сценарию

- [Medium · 2 h · Planned] Массовая бронь (FE): показывать общую сумму по всем блокам (сумма стоимостей всех броней, пересчет при изменении тарифов/услуг/длительности)
- [High · 2 h · Planned] Массовая бронь (FE): подсветка календаря для сценарных ограничений — общий UI/компонент подсветки/tooltip причин
- [High · 6 h · Planned] Массовая бронь (Музыкальная школа): подсветка календаря + блокировка клика по датам, где общие поля не подходят (например, нет доступного выбранного преподавателя)
- [Medium · 4 h · Planned] Массовая бронь (Репетиционная точка): тариф — индивидуальное поле блока; календарь только подсвечиваем по доступности вместимости (people_count >=), клики по дням не блокируем
- [Medium · 4 h · Planned] Массовая бронь (Музыкальный класс): тариф — индивидуальное поле блока; календарь только подсвечиваем по доступности вместимости (people_count >=), клики по дням не блокируем

**Итого по разделу 2.2:** 18 h

---

### 2.3. Создание бронирований (массовое): backend и проверки

- [High · 1 h · Planned] Контракт создания нескольких бронирований: формат запроса с массивом блоков и формат ответа с ошибками по номеру блока и полю
- [High · 3 h · Planned] Backend: endpoint создания нескольких бронирований (без поломки одиночного создания), настройка URL и прав доступа
- [High · 4 h · Planned] Backend: серверная проверка каждого блока массовой брони с учетом сценария (3 сценария — разные обязательные поля и правила)
- [High · 8 h · Planned] Backend: проверки пересечений и конфликтов массовой брони (комната, специалист, рабочее время) + проверки конфликтов между блоками внутри одной формы
- [Medium · 1 h · Planned] Backend: атомарное создание всех блоков массовой брони (одна транзакция) + единый формат ошибок

**Итого по разделу 2.3:** 17 h

---

### 2.4. Массовая бронь: тесты и регрессия

- [Medium · 5 h · Planned] Проверки и регрессия массовой брони: одиночное создание не сломано, сценарии с несколькими блоками, конфликты с существующими бронированиями и между блоками, ручной чек-лист

**Итого по разделу 2.4:** 5 h

---

### 2.5. Календарь: доступность ресурсов и сценариев (UX/FE)

- [High · 1 h · Planned] Календарь (UX): визуальная индикация «неактивного» ресурса/сценария (стиль, курсор, подсказка причины)
- [High · 2 h · Planned] Календарь (FE): учитывать активность комнаты при отрисовке (в сетке остаётся, но клики/создание/редактирование в комнате заблокированы)
- [High · 2 h · Planned] Календарь (FE): учитывать активность помещения при отрисовке (помещение остаётся в сетке, но бронирования/создание внутри полностью недоступны)
- [High · 2 h · Planned] Календарь (FE): отключать создание новых броней при неактивности выбранного сценария (сетку не меняем, только блокируем взаимодействия создания)

**Итого по разделу 2.5:** 7 h

---

### 2.6. Доступность: модели и backend‑защита

- [High · 2 h · Planned] Модель «Комната»: поле активности (is_active), миграция, формы/админка
- [High · 3 h · Planned] Модель «Помещение»: поле активности (is_active), миграция, формы/админка
- [High · 2 h · Planned] Модель «Сценарий»: поле активности (is_active), миграция, формы/админка
- [High · 3 h · Planned] Backend: запретить создание/редактирование брони для неактивного сценария (валидация на endpoint создания/редактирования + текст ошибки)
- [High · 3 h · Planned] Backend: запретить создание/редактирование брони для неактивной комнаты/помещения (валидация на endpoint создания/редактирования + текст ошибки)
- [High · 4 h · Planned] Backend/API: отдавать в календарь флаги активности для сценария/помещения/комнаты, чтобы фронт мог блокировать взаимодействия
- [Medium · 2 h · Planned] Backend: тесты доступности (неактивный сценарий/комната/помещение) + регрессия по существующим сценариям

**Итого по разделу 2.6:** 19 h

---

### 2.7. Календарь: расписание специалистов

- [Medium · 3 h · Planned] Календарь (FE): глобальный тоггл «Показать расписание специалистов» — раскрывает/скрывает блоки расписания сразу на всех видимых днях/колонках
- [Medium · 3 h · Planned] Календарь (FE): сценарно‑зависимые группы специалистов в расписании (МШ: администраторы/преподаватели/техники; РТ+МК: администраторы/техники)
- [Medium · 3 h · Planned] Расписание специалистов (FE): подключение API и отрисовка расписания по ролям с учетом сценария (без изменения сетки)

**Итого по разделу 2.7:** 9 h

---

### 2.8. Бронирования: точечные фиксы

- [Medium · 2 h · Planned] Багфикс: восстановить предупреждение времени начала при сбросе длительности (создание/редактирование)

**Итого по разделу 2.8:** 2 h

---

### 2.9. Главная: фильтры и списки

- [High · 1 h · Planned] Поведение списка клиентов: 10 строк, скролл, ранжировка по алфавиту

**Итого по разделу 2.9:** 1 h

---

### 2.10. Авторизация: шаблон

- [High · 1 h · Planned] Шаблон окна авторизации (базовая вёрстка)

**Итого по разделу 2.10:** 1 h

---

**Суммарно по разделу 2:** 11 h + 18 h + 17 h + 5 h + 7 h + 19 h + 9 h + 2 h + 1 h + 1 h = 90 h

## 3. Итог спринта

- Плановый объём спринта: **≈90 h** (не превышает лимит 90 h).
- Фокус: **множественная бронь** (UI формы, обработка ошибок, интеграция) + **backend контур создания и проверок** + **сценарные подсветки календаря и общая сумма** + **контур доступности для неактивных ресурсов/сценариев**.
